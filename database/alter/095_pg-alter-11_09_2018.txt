set schema 'zafira';
select check_version(95);

DROP TABLE IF EXISTS INVITATIONS;
CREATE TABLE IF NOT EXISTS INVITATIONS (
  ID SERIAL,
  EMAIL VARCHAR(50) NOT NULL,
  TOKEN VARCHAR(255) NOT NULL,
  EXPIRES_IN TIMESTAMP NOT NULL,
  MODIFIED_AT TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  CREATED_AT TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (ID));
CREATE UNIQUE INDEX TOKEN_UNIQUE ON INVITATIONS (TOKEN);
CREATE TRIGGER update_timestamp_invitations BEFORE INSERT OR UPDATE ON INVITATIONS FOR EACH ROW EXECUTE PROCEDURE update_timestamp();

ALTER TABLE USERS ADD COLUMN SOURCE VARCHAR(20) NOT NULL DEFAULT 'INTERNAL';

select add_version(95);
