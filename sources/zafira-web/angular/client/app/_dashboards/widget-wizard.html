<md-dialog flex="50" aria-label="Widget modal" style="max-width:fit-content; min-width: 950px" zafira-background-theme="modal">
    <section class="panel panel-default" style="margin-bottom: 0">
        <div class="panel-body padding-xl">
            <div class="row">
                <div class="col-md-12">

                    <section class="ui-angular-wizard" >
                        <span>Create widget</span>
                        <div class="divider divider-lg"></div>
                        <wizard on-finish="finished()" indicators-position="top">
                            <wz-step wz-title="Start information" canexit="exitWithAPromise">
                                <h2>Widget name</h2>
                                <div class="ui-wizard-content">
                                    <form class="form-validation" name="name_form" ng-submit="UtilService.untouchForm(name_form)" ng-cloak>
                                        <div layout layout-sm="column">
                                            <md-input-container flex>
                                                <label>Title</label>
                                                <input type="text" ng-model="widget.title" name="title" required/>
                                            </md-input-container>
                                        </div>
                                    </form>
                                    <div layout layout-sm="column" data-ng-if="'sql' != widget.type">
                                        <md-input-container style="float: right; margin-top: 0" flex>
                                            <span>Refreshable</span>
                                            <md-switch style="margin-top: 0" class="md-primary" ng-model="widget.refreshable" ng-required aria-label="integr-switch"></md-switch>
                                        </md-input-container>
                                    </div>
                                </div>
                                <div class="ui-wizard-actions">
                                    <md-button wz-next="" class="md-raised btn-w-md md-primary" ng-disabled="name_form.$invalid">NEXT</md-button>
                                </div>
                            </wz-step>
                            <wz-step wz-title="Type" canexit="exitValidation">
                                <h2>Widget type</h2>
                                <div class="ui-wizard-content">
                                    <form class="form-validation" name="type_form" ng-submit="UtilService.untouchForm(type_form)" ng-cloak>
                                        <!--<div layout layout-sm="column">
                                            <md-input-container flex>
                                                <md-select ng-model="widget.type" name="type" placeholder="Type" required>
                                                    <md-option value="" disabled>Type</md-option>
                                                    <md-option value="linechart">Line chart</md-option>
                                                    <md-option value="piechart">Pie chart</md-option>
                                                    <md-option value="table">Table</md-option>
                                                </md-select>
                                            </md-input-container>
                                        </div>-->
                                        <label class="color-option-check" style="display: inline-block">
                                            <input type="radio" name="color" value="linechart" ng-model="widget.type">
                                            <span class="color-option-item bg-page" style="height: 200px; width: 200px">
                                            <span class="overlay"><span class="material-icons">check</span></span>
                                            <span>Line chart</span>
                                        </span>
                                        </label>
                                        <label class="color-option-check" style="display: inline-block">
                                            <input type="radio" name="color" value="piechart" ng-model="widget.type">
                                            <span class="color-option-item bg-page" style="height: 200px; width: 200px">
                                            <span class="overlay"><span class="material-icons">check</span></span>
                                            <span>Pie chart</span>
                                        </span>
                                        </label>
                                        <label class="color-option-check" style="display: inline-block">
                                            <input type="radio" name="color" value="table" ng-model="widget.type">
                                            <span class="color-option-item bg-page" style="height: 200px; width: 200px">
                                            <span class="overlay"><span class="material-icons">check</span></span>
                                            <span>Table</span>
                                        </span>
                                        </label>
                                    </form>
                                </div>
                                <div class="ui-wizard-actions">
                                    <md-button wz-previous=""  class="md-raised btn-w-md">BACK</md-button>
                                    <md-button wz-next="" class="md-raised btn-w-md md-primary" ng-disabled="type_form.$invalid">NEXT</md-button>
                                </div>
                            </wz-step>
                            <wz-step wz-title="SQL" canexit="exitValidation">
                                <h2>SQL data</h2>
                                <div class="ui-wizard-content">
                                    <form class="form-validation" name="sql_form" ng-submit="UtilService.untouchForm(sql_form)" ng-cloak>
                                        <md-progress-circular md-mode="indeterminate" md-diameter="31px" ng-if="isLoading" style="left:50%"></md-progress-circular>
                                        <div data-ng-if="widget.data" align="center" class="panel-body" data-ng-class="{'graph-box' :  (widget.executeType == 'linechart' || widget.executeType == 'piechart')}">
                                            <div layout layout-sm="column" class="pull-right">
                                                <i data-ng-click="closeWidget()" data-ng-if="showWidget" class="fa fa-window-close"></i>
                                            </div>
                                            <linechart data-ng-if="widget.executeType == 'linechart'" data="widget.data" options="widget.testModel"></linechart>
                                            <div data-ng-if="widget.executeType == 'piechart'" class="pie-chart">
                                                <pie-chart data="widget.data.dataset" options="widget.testModel"></pie-chart>
                                            </div>
                                            <div data-ng-if="widget.executeType == 'table'" class="table-responsive" style="max-height: 350px; max-width: 1300px">
                                                <table class="table table-striped table-bordered table-hover" style="width: 100%;">
                                                    <thead>
                                                    <tr>
                                                        <th class="pointer" data-ng-repeat="column in widget.testModel.columns" data-ng-click="changeSorting(column)">
                                                            {{column}}&nbsp;<i class="fa fa-sort"></i>
                                                        </th>
                                                    </tr>
                                                    </thead>
                                                    <tbody>
                                                    <tr data-ng-repeat="row in widget.data.dataset | orderBy:sort.column:sort.descending">
                                                        <td data-ng-repeat="column in widget.testModel.columns" data-ng-bind-html="asString(row[column])" data-ng-style="widget.testModel.columns.length > 1 && {'max-width': '500px'}"></td>
                                                    </tr>
                                                    <tr class="text-center" data-ng-if="widget.data.dataset == 0">
                                                        <td colspan="{{widget.testModel.columns.length}}">No data</td>
                                                    </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                        <div layout layout-sm="column">
                                            <label>SQL</label>
                                            <md-input-container flex>
                                                <code-textarea id="sql" ng-model="widget.sql" code-data="{{widget.sql}}" code-class="sql"></code-textarea>
                                                <!--<textarea class="code" data-ng-model="widget.sql" rows="15" required></textarea>-->
                                            </md-input-container>
                                        </div>
                                    </form>
                                </div>
                                <div class="ui-wizard-actions">
                                    <md-button wz-previous=""  class="md-raised btn-w-md">BACK</md-button>
                                    <md-button wz-next="" class="md-raised btn-w-md md-primary" ng-disabled="sql_form.$invalid || !widget.sql">NEXT</md-button>
                                </div>
                            </wz-step>
                            <wz-step wz-title="Finish him">
                                <h2>Model</h2>
                                <div class="ui-wizard-content">
                                    <form class="form-validation" name="model_form" ng-submit="UtilService.untouchForm(model_form)" ng-cloak>
                                        <div layout layout-sm="column" data-ng-if="'sql' != widget.type">
                                            <label>Model</label>
                                            <md-input-container flex>
                                                <code-textarea id="model" ng-model="widget.model" code-data="{{widget.model}}"></code-textarea>
                                            </md-input-container>
                                        </div>
                                    </form>
                                </div>
                                <div class="ui-wizard-actions">
                                    <md-button wz-previous=""  class="md-raised btn-w-md">BACK</md-button>
                                    <md-button data-ng-if="isNew" wz-next="createWidget(widget)" class="md-raised btn-w-md md-primary" ng-disabled="model_form.$invalid">Create</md-button>
                                    <md-button data-ng-if="!isNew" wz-next="updateWidget(widget)" class="md-raised btn-w-md md-primary" ng-disabled="model_form.$invalid">Save</md-button>
                                </div>
                            </wz-step>
                        </wizard>
                    </section>
                </div>
            </div>
        </div>
    </section>
</md-dialog>
